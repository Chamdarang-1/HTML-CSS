<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>아이디 찾기</title>
    <style>
        :root {
            --black: #111;
            --gray: #777;
            --light: #f4f5f7;
            --primary: #111;
            --accent: #3F97F6;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            margin: 0
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Pretendard, Apple SD Gothic Neo, Malgun Gothic, Noto Sans KR, sans-serif;
            color: var(--black);
            background: #fff
        }

        .wrap {
            max-width: 720px;
            margin: 48px auto;
            padding: 0 20px
        }

        h1 {
            font-size: 40px;
            letter-spacing: -.02em;
            margin: 0 0 24px;
            text-align: center
        }

        .desc {
            color: #555;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 28px
        }

        .card {
            background: #fff;
            border: 1px solid #e6e6e6;
            border-radius: 6px;
            padding: 28px 24px
        }

        .row {
            margin-bottom: 18px
        }

        label {
            display: block;
            font-weight: 600;
            margin: 0 0 8px
        }

        .field {
            width: 100%;
            height: 48px;
            padding: 0 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            outline: none
        }

        .field:focus {
            border-color: #222;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, .06)
        }

        .radio-line {
            display: flex;
            gap: 18px;
            align-items: center
        }

        .radio-line .item {
            display: flex;
            gap: 8px;
            align-items: center
        }

        .helper {
            font-size: 13px;
            color: #888;
            margin-top: 6px
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 24px
        }

        .btn {
            flex: 1 1 0;
            height: 50px;
            border-radius: 4px;
            border: 1px solid #111;
            background: #111;
            color: #fff;
            font-weight: 700;
            cursor: pointer
        }

        .btn.secondary {
            background: #fff;
            color: #111
        }

        .btn:disabled {
            opacity: .5;
            cursor: not-allowed
        }

        .inline {
            display: flex;
            gap: 10px;
            align-items: center
        }

        .sub-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px
        }

        .hidden {
            display: none
        }

        .select {
            width: 100%;
            height: 48px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0 12px
        }

        .bar {
            height: 1px;
            background: #eee;
            margin: 20px 0
        }
    </style>
</head>
<script>
    fetch("../main/header.html") //각자 주소 수정!!!
        .then(res => res.text())
        .then(data => {
            document.getElementById("header").innerHTML = data;

            // header.html 안의 스크립트 실행 강제
            const scripts = document.getElementById("header").querySelectorAll("script");
            scripts.forEach(oldScript => {
                const newScript = document.createElement("script");
                if (oldScript.src) {
                    newScript.src = oldScript.src;
                } else {
                    newScript.textContent = oldScript.textContent;
                }
                document.body.appendChild(newScript);
            });
        });


    fetch("../main/footer.html") //각자 주소 수정!!!
        .then(res => res.text())
        .then(data => {
            document.getElementById("footer").innerHTML = data;
        });
</script>


<body>
    <div id="header"></div>
    <div class="wrap">
        <h1>아이디 찾기</h1>
        <p class="desc">가입하신 방법에 따라 아이디 찾기가 가능합니다.<br>법인/외국인 회원의 경우 필요한 정보를 정확히 입력해 주세요.</p>

        <div class="card">
            <!-- 회원유형 (선택사항: 화면과 톤 맞춤) -->
            <div class="row">
                <label for="memberType">회원유형</label>
                <select id="memberType" class="select" aria-label="회원유형">
                    <option value="personal">개인회원</option>
                    <option value="business">법인회원</option>
                    <option value="foreign">외국인회원</option>
                </select>
            </div>

            <!-- 인증 방식 -->
            <div class="row">
                <label>인증 방식</label>
                <div class="radio-line" role="radiogroup" aria-label="인증 방식">
                    <label class="item"><input type="radio" name="method" value="email" checked> 이메일</label>
                    <label class="item"><input type="radio" name="method" value="phone"> 휴대폰 인증</label>
                </div>
            </div>

            <!-- 이름 입력 -->
            <div class="row">
                <label for="name">이름</label>
                <input id="name" class="field" type="text" placeholder="이름을 입력하세요" autocomplete="name" required>
            </div>

            <div class="bar" aria-hidden="true"></div>

            <!-- 이메일 인증 영역 -->
            <section id="emailSection" aria-label="이메일 인증">
                <div class="row">
                    <label for="email">이메일로 찾기</label>
                    <input id="email" class="field" type="email" placeholder="example@domain.com" autocomplete="email">
                    <p class="helper">입력하신 이메일로 인증번호를 전송합니다.</p>
                </div>
                <div class="sub-actions">
                    <button id="sendEmailCode" class="btn" type="button">인증번호 전송</button>
                </div>
                <div id="emailVerifyGroup" class="row hidden">
                    <label class="sr-only" for="emailCode">인증번호</label>
                    <div class="inline">
                        <input id="emailCode" class="field" type="text" inputmode="numeric" pattern="[0-9]*"
                            placeholder="전송받은 인증번호 입력">
                        <button id="verifyEmailCode" class="btn" type="button">확인</button>
                    </div>
                </div>
            </section>

            <!-- 휴대폰 인증 영역 -->
            <section id="phoneSection" class="hidden" aria-label="휴대폰 인증">
                <div class="row">
                    <label for="phone">휴대폰 번호로 찾기</label>
                    <input id="phone" class="field" type="tel" inputmode="tel" placeholder="01012345678"
                        maxlength="11" />
                    <p class="helper">하이픈(-) 없이 숫자만 입력하세요.</p>
                </div>
                <div class="sub-actions">
                    <button id="sendSmsCode" class="btn" type="button">인증번호 전송</button>
                </div>
                <div id="phoneVerifyGroup" class="row hidden">
                    <label class="sr-only" for="smsCode">인증번호</label>
                    <div class="inline">
                        <input id="smsCode" class="field" type="text" inputmode="numeric" pattern="[0-9]*"
                            placeholder="전송받은 인증번호 입력">
                        <button id="verifySmsCode" class="btn" type="button">확인</button>
                    </div>
                </div>
            </section>

            <div class="actions">
                <button id="cancelBtn" class="btn secondary" type="button" onclick="location.href='#'">취소</button>
                <button id="nextBtn" class="btn" type="button" disabled>다음</button>
            </div>
        </div>

        <p class="helper" style="margin-top:14px">※ 실제 발송·검증·아이디 조회는 서버 연동 필요 (코드에 연결 지점 주석 표기).</p>
    </div>

    <script>
        // ===== 상태 관리 =====
        const state = {
            method: 'email',
            emailCode: null,
            smsCode: null,
            emailVerified: false,
            phoneVerified: false
        };

        const $ = (sel) => document.querySelector(sel);
        const $$ = (sel) => Array.from(document.querySelectorAll(sel));

        const emailSection = $('#emailSection');
        const phoneSection = $('#phoneSection');
        const nextBtn = $('#nextBtn');

        function toggleSections() {
            if (state.method === 'email') {
                emailSection.classList.remove('hidden');
                phoneSection.classList.add('hidden');
            } else {
                phoneSection.classList.remove('hidden');
                emailSection.classList.add('hidden');
            }
            updateNextAvailability();
        }

        function validateBasic() {
            const nameOk = $('#name').value.trim().length >= 2;
            if (state.method === 'email') {
                const email = $('#email').value.trim();
                const emailOk = /.+@.+\..+/.test(email);
                return nameOk && emailOk && state.emailVerified;
            } else {
                const phone = $('#phone').value.trim();
                const phoneOk = /^01[0-9]{8,9}$/.test(phone);
                return nameOk && phoneOk && state.phoneVerified;
            }
        }

        function updateNextAvailability() {
            nextBtn.disabled = !validateBasic();
        }

        // 인증 방식 라디오
        $$('input[name="method"]').forEach(r => {
            r.addEventListener('change', (e) => {
                state.method = e.target.value;
                toggleSections();
            });
        });

        // 입력 변경 시 다음 버튼 활성화 갱신
        ['#name', '#email', '#phone', '#emailCode', '#smsCode'].forEach(sel => {
            const el = $(sel); if (!el) return; el.addEventListener('input', updateNextAvailability);
        });

        // ===== 인증번호 전송 (Mock) =====
        function pseudoSend(to) {
            // 실제 구현 시: 아래 fetch()를 사용해 서버로 전송
            // fetch('/api/auth/send-code', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ method: state.method, to, name: $('#name').value })})
            //   .then(r=>r.json()).then(({success})=>{ if(success){ ... }})
            return new Promise(resolve => setTimeout(resolve, 600));
        }

        $('#sendEmailCode').addEventListener('click', async () => {
            const email = $('#email').value.trim();
            if (!/.+@.+\..+/.test(email)) { alert('이메일 형식을 확인해 주세요.'); return; }
            await pseudoSend(email);
            // 데모용 6자리 코드 생성
            state.emailCode = String(Math.floor(100000 + Math.random() * 900000));
            console.log('[DEV] email code:', state.emailCode); // 개발 편의를 위한 출력 (배포 시 제거)
            $('#emailVerifyGroup').classList.remove('hidden');
            alert('인증 번호를 전송했습니다!');
        });

        $('#sendSmsCode').addEventListener('click', async () => {
            const phone = $('#phone').value.trim();
            if (!/^01[0-9]{8,9}$/.test(phone)) { alert('휴대폰 번호를 정확히 입력해 주세요.'); return; }
            await pseudoSend(phone);
            state.smsCode = String(Math.floor(100000 + Math.random() * 900000));
            console.log('[DEV] sms code:', state.smsCode);
            $('#phoneVerifyGroup').classList.remove('hidden');
            alert('인증 번호를 전송했습니다!');
        });

        // ===== 인증번호 확인 (Mock) =====
        $('#verifyEmailCode').addEventListener('click', () => {
            const input = $('#emailCode').value.trim();
            if (input && input === state.emailCode) {
                state.emailVerified = true;
                alert('확인되었습니다!');
                updateNextAvailability();
                // 검증 완료 후 자동 이동을 원하면 아래 주석 해제
                // location.href = '/account/find-id/verify'; // TODO: 실제 주소로 변경
            } else {
                alert('인증번호가 일치하지 않습니다.');
            }
        });

        $('#verifySmsCode').addEventListener('click', () => {
            const input = $('#smsCode').value.trim();
            if (input && input === state.smsCode) {
                state.phoneVerified = true;
                alert('확인되었습니다!');
                updateNextAvailability();
                // location.href = '/account/find-id/verify'; // TODO: 실제 주소로 변경
            } else {
                alert('인증번호가 일치하지 않습니다.');
            }
        });

        // ===== 다음 버튼 =====
        nextBtn.addEventListener('click', () => {
            if (!validateBasic()) {
                alert('이름과 연락처 입력 및 인증을 완료해 주세요.');
                return;
            }
            // 실제 구현 시: 서버에 전송하여 DB와 비교 후 아이디 결과 페이지로 이동
            // fetch('/api/account/find-id', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({
            //   memberType: $('#memberType').value,
            //   method: state.method,
            //   name: $('#name').value.trim(),
            //   email: $('#email').value.trim(),
            //   phone: $('#phone').value.trim()
            // })}).then(r=>r.json()).then(data=>{
            //   // 성공 시 결과 페이지로 이동하며, 조회된 아이디(마스킹)를 쿼리나 상태로 전달
            //   location.href = '/account/find-id/result'; // TODO: 실제 주소로 변경
            // });

            // 데모 동작: 결과 페이지로 이동 (실주소로 교체)
            location.href = '/account/find-id/result'; // TODO: 실제 주소로 변경
        });

        // 초기 상태
        toggleSections();
    </script>

    <div id="footer"></div>
</body>

</html>